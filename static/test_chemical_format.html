<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemical Equation Test</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h3>Chemical Equation Formatting Test</h3>
        <div class="message assistant-message mb-3">
            <div class="message-content">
                <div class="message-text" id="testContent">
                    Test content will be inserted here by JavaScript
                </div>
            </div>
        </div>
        
        <h4>Test Input</h4>
        <textarea id="testInput" class="form-control mb-3" rows="5">Water is H2O and carbon dioxide is CO2. The reaction is: CH4 + 2O2 -> CO2 + 2H2O. Sodium has a charge of Na+ and chloride is Cl-. Sulfuric acid is H2SO4.</textarea>
        
        <button onclick="testFormat()" class="btn btn-primary">Test Chemical Formatting</button>
        
        <h4 class="mt-4">Raw HTML Output</h4>
        <pre id="rawOutput" class="bg-dark text-light p-3" style="white-space: pre-wrap;"></pre>
    </div>

    <script>
        // Copy the chemical formatting function from chat.js
        function formatChemicalEquations(content) {
            // Convert underscore notation to subscripts (H_2O becomes H₂O)
            content = content.replace(/([A-Za-z])_(\d+)/g, '$1<sub>$2</sub>');
            content = content.replace(/([A-Za-z])_([a-z])/g, '$1<sub>$2</sub>');
            
            // Convert caret notation to superscripts (x^2 becomes x²)
            content = content.replace(/([A-Za-z0-9])\^(\d+)/g, '$1<sup>$2</sup>');
            content = content.replace(/([A-Za-z0-9])\^([+-])/g, '$1<sup>$2</sup>');
            
            // Handle common chemical formulas with proper subscripts
            content = content.replace(/\bH2O\b/g, 'H<sub>2</sub>O');
            content = content.replace(/\bCO2\b/g, 'CO<sub>2</sub>');
            content = content.replace(/\bNH3\b/g, 'NH<sub>3</sub>');
            content = content.replace(/\bCH4\b/g, 'CH<sub>4</sub>');
            content = content.replace(/\bHCl\b/g, 'HCl');
            content = content.replace(/\bNaCl\b/g, 'NaCl');
            content = content.replace(/\bCaCO3\b/g, 'CaCO<sub>3</sub>');
            content = content.replace(/\bH2SO4\b/g, 'H<sub>2</sub>SO<sub>4</sub>');
            content = content.replace(/\bHNO3\b/g, 'HNO<sub>3</sub>');
            content = content.replace(/\bNaOH\b/g, 'NaOH');
            content = content.replace(/\bO2\b/g, 'O<sub>2</sub>');
            content = content.replace(/\bN2\b/g, 'N<sub>2</sub>');
            content = content.replace(/\bCl2\b/g, 'Cl<sub>2</sub>');
            
            // Handle ionic charges with superscripts
            content = content.replace(/([A-Za-z]+)(\d*)\+/g, '$1$2<sup>+</sup>');
            content = content.replace(/([A-Za-z]+)(\d*)-/g, '$1$2<sup>-</sup>');
            content = content.replace(/\b([A-Za-z]+)(\d+)\+(\d+)\b/g, '$1$2<sup>+$3</sup>');
            content = content.replace(/\b([A-Za-z]+)(\d+)-(\d+)\b/g, '$1$2<sup>-$3</sup>');
            
            // Handle common chemical reaction arrows
            content = content.replace(/-->/g, ' → ');
            content = content.replace(/->/g, ' → ');
            content = content.replace(/<--/g, ' ← ');
            content = content.replace(/<->/g, ' ↔ ');
            content = content.replace(/<=>/g, ' ⇌ ');
            content = content.replace(' -> ', ' → ');
            content = content.replace(' <- ', ' ← ');
            content = content.replace(' <-> ', ' ↔ ');
            content = content.replace(' <=> ', ' ⇌ ');
            
            return content;
        }

        function testFormat() {
            const input = document.getElementById('testInput').value;
            const formatted = formatChemicalEquations(input);
            
            // Display the formatted content
            document.getElementById('testContent').innerHTML = formatted;
            
            // Show raw HTML
            document.getElementById('rawOutput').textContent = formatted;
            
            console.log('Original:', input);
            console.log('Formatted:', formatted);
        }

        // Test on page load
        window.onload = function() {
            testFormat();
        };
    </script>
</body>
</html>